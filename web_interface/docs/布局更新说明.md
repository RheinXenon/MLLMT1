# 聊天页面布局更新说明

## 更新日期
2025年11月2日

## 更新概述
对Lingshu-7B Web界面进行了重大改版，实现了更现代化的多聊天会话管理功能，并将设置功能独立成专门的设置页面。

## 主要变更

### 1. 多聊天会话管理
- **创建新聊天**：左侧新增"创建新聊天"按钮，随时开始新对话
- **历史聊天列表**：左侧显示所有历史对话，可快速切换
- **聊天持久化**：使用localStorage本地保存聊天历史
- **自动命名**：首次发送消息时自动提取标题
- **手动重命名**：支持对聊天进行重命名

### 2. 聊天操作功能
- **切换聊天**：点击历史列表中的任意聊天即可切换
- **清空对话**：清空当前聊天的所有消息（保留会话）
- **删除对话**：完全删除某个聊天会话
- **上下文记忆**：每个聊天保持独立的对话上下文

### 3. 设置页面独立
- **新增设置页面**：`/settings.html`
- **模型控制**：加载/卸载模型
- **模型状态**：查看详细的模型和GPU状态
- **生成参数**：调整Temperature和MaxTokens
- **使用说明**：展示功能特性介绍

### 4. 主聊天页面优化
- **简化侧边栏**：移除冗余的模型控制，仅保留核心功能
- **设置入口**：右上角设置按钮，快速跳转设置页面
- **状态显示**：底部显示简化的模型加载状态

## 文件结构

### 新增文件
```
web_interface/
├── frontend/
│   ├── settings.html          # 新增：设置页面
│   └── static/
│       └── js/
│           └── settings.js    # 新增：设置页面逻辑
└── docs/
    └── 布局更新说明.md        # 本文档
```

### 修改文件
```
web_interface/
├── backend/
│   └── app.py                 # 添加settings路由
└── frontend/
    ├── index.html             # 重构主页布局
    └── static/
        ├── css/
        │   └── style.css      # 添加新样式
        └── js/
            └── main.js        # 重写多会话管理逻辑
```

## 技术实现

### 前端数据结构
```javascript
// 聊天会话数据结构
{
    id: 'chat_1234567890',
    title: '对话标题',
    messages: [
        {
            role: 'user/assistant',
            content: '消息内容',
            imageUrl: '图片URL（可选）',
            timestamp: 时间戳
        }
    ],
    sessionId: '后端会话ID',
    createdAt: 创建时间戳,
    updatedAt: 更新时间戳
}
```

### 本地存储
- **位置**：`localStorage.chats`
- **格式**：JSON字符串
- **持久化**：自动保存，浏览器重启后依然可用

### 会话管理
- **前端**：管理多个聊天会话的UI显示和切换
- **后端**：为每个会话保持独立的对话历史
- **关联**：通过sessionId关联前后端

## 用户操作流程

### 首次使用
1. 访问主页（显示欢迎消息）
2. 点击左下角设置按钮（⚙️）进入设置页面
3. 点击"加载模型"按钮
4. 返回主页开始对话

### 日常使用
1. 在主页输入问题发送
2. 查看AI回复
3. 点击"创建新聊天"开始新话题
4. 点击左侧列表切换到历史对话
5. 支持上传图片进行多模态分析

### 管理聊天
- **重命名**：点击标题旁的✏️图标
- **清空**：点击"清空对话"按钮
- **删除**：点击"删除对话"按钮（红色）

## 兼容性

### 浏览器支持
- ✅ Chrome/Edge (推荐)
- ✅ Firefox
- ✅ Safari
- ⚠️ IE不支持（使用了现代Web API）

### 数据迁移
- 旧版本的对话历史不会自动迁移
- 首次使用新版本会创建空的聊天列表
- 如需保留旧数据，请手动备份`localStorage`

## 快捷键

- **Ctrl/Cmd + Enter**：发送消息
- **Esc**（未实现）：取消当前操作

## 已知限制

1. **存储限制**：localStorage通常限制为5-10MB
2. **图片存储**：图片仅保存为Blob URL，不持久化
3. **跨设备**：聊天记录仅保存在本地，不同设备不同步
4. **并发限制**：同一时间只能进行一个对话生成

## 未来改进计划

- [ ] 支持聊天记录导出（JSON/Markdown）
- [ ] 支持聊天记录搜索
- [ ] 支持聊天记录云端同步
- [ ] 支持深色模式
- [ ] 支持自定义快捷键
- [ ] 支持消息编辑和重新生成
- [ ] 支持流式输出（Server-Sent Events）

## 故障排查

### 问题1：设置页面无法访问
**解决方案**：确保后端已添加`/settings.html`路由

### 问题2：聊天记录丢失
**解决方案**：检查浏览器localStorage是否被清除

### 问题3：切换聊天后消息不显示
**解决方案**：刷新页面，检查控制台错误日志

### 问题4：模型状态不更新
**解决方案**：前往设置页面查看详细状态

## 技术支持

如有问题，请查看：
1. 浏览器控制台错误信息
2. 后端服务器日志
3. 项目README文档
4. 提交GitHub Issue

---

**最后更新**：2025年11月2日
**版本**：v2.0

